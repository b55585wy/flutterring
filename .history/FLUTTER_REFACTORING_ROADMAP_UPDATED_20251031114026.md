# OpenRing Flutter é‡æ„è·¯çº¿å›¾ - æ›´æ–°ç‰ˆ

> **æ›´æ–°æ—¶é—´**: 2024-10-31  
> **å½“å‰çŠ¶æ€**: é˜¶æ®µ 1.1 éƒ¨åˆ†å®Œæˆï¼ˆæ‰«æ+è¿æ¥ï¼‰ï¼Œå‡†å¤‡å¼€å§‹é˜¶æ®µ 1.2

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### é˜¶æ®µ 0: å‡†å¤‡å·¥ä½œï¼ˆå·²å®Œæˆ âœ“ï¼‰

#### âœ… ä»»åŠ¡ 0.1: Flutter é¡¹ç›®åˆå§‹åŒ–
- [x] åˆ›å»º Flutter é¡¹ç›® `openring_flutter`
- [x] é…ç½® `pubspec.yaml` ä¾èµ–
  - flutter_riverpod: ^2.6.1
  - fl_chart: ^0.68.0
  - intl: ^0.19.0
  - logger: ^2.2.0
- [x] é…ç½® Android Manifest æƒé™
- [x] é…ç½® Android AAR é›†æˆ
  - å¤åˆ¶ `Chiplet1.0.81.aar` åˆ° `android/app/libs/`
  - æ›´æ–° `build.gradle` é…ç½®
- [x] è§£å†³ Gradle/Java ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜
  - Gradle 8.7
  - JDK 21
  - Kotlin 1.9.20
  - Android Gradle Plugin 8.3.2
  - minSdk 26 (AAR è¦æ±‚)
  - NDK 25.1.8937393

#### âœ… ä»»åŠ¡ 0.2: ç²¾è‡´ UI æ¡†æ¶æ­å»º
- [x] åˆ›å»ºä¸»åº”ç”¨å…¥å£ (`main.dart`)
- [x] åˆ›å»ºåº•éƒ¨å¯¼èˆªæ  (`HomePage`)
- [x] åˆ›å»º 4 ä¸ªä¸»è¦é¡µé¢
  - [x] **DashboardPage**: ä»ªè¡¨ç›˜ï¼ˆè¿æ¥çŠ¶æ€ã€è®¾å¤‡ä¿¡æ¯ã€å¿«æ·æ“ä½œï¼‰
  - [x] **MeasurementPage**: æµ‹é‡é¡µé¢ï¼ˆæ•°æ®æºé€‰æ‹©ã€æ³¢å½¢ã€æŒ‡æ ‡ã€æ§åˆ¶ï¼‰
  - [x] **HistoryPage**: å†å²è®°å½•ï¼ˆæœ¬å‘¨æ¦‚è§ˆã€æ‰€æœ‰è®°å½•åˆ—è¡¨ï¼‰
  - [x] **SettingsPage**: è®¾ç½®é¡µé¢ï¼ˆè®¾å¤‡ç®¡ç†ã€æ•°æ®ç®¡ç†ã€åº”ç”¨è®¾ç½®ï¼‰
- [x] å®ç°ç²¾è‡´ç°ä»£åŒ– Material Design 3 UI
  - å¡ç‰‡å¼å¸ƒå±€
  - åœ†è§’è®¾è®¡
  - åŠ¨ç”»æ•ˆæœï¼ˆå¿ƒè·³åŠ¨ç”»ã€è¿›åº¦æ¡ï¼‰
  - å®æ—¶æ³¢å½¢å›¾ï¼ˆCustomPainterï¼‰
  - ç”Ÿç†æŒ‡æ ‡å¡ç‰‡ï¼ˆHR/RR/ä¿¡å·è´¨é‡ï¼‰
- [x] åº”ç”¨æˆåŠŸè¿è¡Œåœ¨æ¨¡æ‹Ÿå™¨ä¸Š

#### âœ… ä»»åŠ¡ 0.3: Platform Channel æ¡†æ¶æ­å»º
- [x] åˆ›å»º Dart ä¾§ Platform æ¥å£ (`ring_platform.dart`)
  - MethodChannel: `com.tsinghua.openring/ble_method`
  - EventChannel: `com.tsinghua.openring/ble_event`
- [x] åˆ›å»º Android ä¾§ MainActivity.ktï¼ˆç”¨æˆ·è‡ªè¡Œå®ç°ï¼‰
  - MethodChannel å¤„ç†å™¨
  - EventChannel æµå¤„ç†å™¨
- [x] é›†æˆ BLE æ‰«æå’Œè¿æ¥åŠŸèƒ½åˆ° DashboardPage
  - æ‰«ææŒ‰é’®
  - è®¾å¤‡åˆ—è¡¨å±•ç¤º
  - è¿æ¥çŠ¶æ€æ˜¾ç¤º

---

## ğŸš€ ä¸‹ä¸€é˜¶æ®µè®¡åˆ’

### é˜¶æ®µ 1: Platform Channel å®Œå–„ä¸ BLE é›†æˆï¼ˆé¢„è®¡ 3-4 å¤©ï¼‰

#### ğŸ“‹ ä»»åŠ¡ 1.1: å®Œå–„ MainActivity.kt BLE åŠŸèƒ½å®ç°

**ç›®æ ‡**: å°†ç”¨æˆ·ç¼–å†™çš„ MainActivity.kt ä¸ AAR åº“é›†æˆï¼Œå®ç°çœŸå® BLE åŠŸèƒ½ã€‚

**å­ä»»åŠ¡**:
1. **éªŒè¯ MainActivity.kt åŸºæœ¬åŠŸèƒ½** âœ… **å·²å®Œæˆ**
   - [x] æµ‹è¯•æ‰«æåŠŸèƒ½ï¼ˆscanDevicesï¼‰ âœ…
   - [x] æµ‹è¯•è¿æ¥åŠŸèƒ½ï¼ˆconnectDeviceï¼‰ âœ…
   - [x] æµ‹è¯•æ–­è¿åŠŸèƒ½ï¼ˆdisconnectï¼‰ âœ…
   - [x] éªŒè¯ EventChannel äº‹ä»¶æµé€šï¼ˆdeviceFound, connectionStateChangedï¼‰ âœ…
   - [x] ä½¿ç”¨ LogicalApi è¿‡æ»¤è®¾å¤‡ï¼ˆä»…æ˜¾ç¤º OpenRing æ™ºèƒ½æˆ’æŒ‡ï¼‰ âœ…
   - [x] æ³¨å†Œ BLEService åˆ° AndroidManifest.xml âœ…
   - [x] æ·»åŠ è¿æ¥æ—¥å¿—ï¼ˆä¾¿äºè°ƒè¯•ï¼‰ âœ…

2. **é›†æˆ AAR åº“çš„æ ¸å¿ƒæ–¹æ³•** ğŸš§ **ä¸‹ä¸€æ­¥**
   - [ ] å®ç° `startLiveMeasurement(duration)` - å¯åŠ¨åœ¨çº¿æµ‹é‡
   - [ ] å®ç° `stopMeasurement()` - åœæ­¢æµ‹é‡
   - [ ] å®ç° `getDeviceInfo()` - è·å–è®¾å¤‡ç‰ˆæœ¬ã€ç”µé‡
   - [ ] å®ç° `getBatteryLevel()` - è·å–ç”µé‡
   - [ ] å®ç° `updateDeviceTime()` - åŒæ­¥æ—¶é—´
   - [ ] å®ç° `calibrateTime()` - æ ¡å‡†æ—¶é—´

3. **å®ç°å®æ—¶æ•°æ®æµ** ğŸš§ **ä¸‹ä¸€æ­¥**
   - [ ] å®ç° `onCharacteristicChanged` å›è°ƒè§£æ
   - [ ] å°†åŸå§‹ BLE æ•°æ®è½¬æ¢ä¸º `SampleBatch` äº‹ä»¶
   - [ ] å‘é€åˆ° EventChannel
   - [ ] Dart ä¾§æ¥æ”¶å¹¶è§£ææ•°æ®

**éªŒæ”¶æ ‡å‡†**:
- âœ… å¯ä»¥æˆåŠŸæ‰«æå¹¶è¿æ¥æˆ’æŒ‡ï¼ˆå·²å®Œæˆï¼‰
- â³ å¯åŠ¨æµ‹é‡åï¼ŒDart ä¾§å¯æ¥æ”¶åˆ°å®æ—¶æ•°æ®æµï¼ˆä¸‹ä¸€æ­¥ï¼‰
- â³ æ•°æ®æ ¼å¼æ­£ç¡®ï¼ˆåŒ…å« PPGÃ—3, ACCÃ—3, GyroÃ—3, TempÃ—3ï¼‰ï¼ˆä¸‹ä¸€æ­¥ï¼‰

**é¢„è®¡æ—¶é—´**: 1-2 å¤©  
**å®é™…è¿›åº¦**: å·²å®Œæˆ 30%ï¼ˆæ‰«æ+è¿æ¥ï¼‰

---

#### ğŸ“‹ ä»»åŠ¡ 1.2: æ•°æ®æ¨¡å‹ä¸äº‹ä»¶ç³»ç»Ÿ

**ç›®æ ‡**: å®šä¹‰å®Œæ•´çš„ Freezed æ•°æ®æ¨¡å‹ï¼Œå®ç°ç±»å‹å®‰å…¨çš„äº‹ä»¶ç³»ç»Ÿã€‚

**æ–‡ä»¶åˆ›å»º**:
1. **`lib/models/ble_event.dart`** - BLE äº‹ä»¶æ¨¡å‹
   ```dart
   @freezed
   class BleEvent with _$BleEvent {
     const factory BleEvent.connectionStateChanged({...}) = ConnectionStateChanged;
     const factory BleEvent.sampleBatch({...}) = SampleBatchEvent;
     const factory BleEvent.vitalSignsUpdate({...}) = VitalSignsUpdateEvent;
     const factory BleEvent.deviceFound({...}) = DeviceFoundEvent;
     const factory BleEvent.scanCompleted() = ScanCompletedEvent;
     const factory BleEvent.error({...}) = BleErrorEvent;
   }
   ```

2. **`lib/models/sample.dart`** - ä¼ æ„Ÿå™¨æ ·æœ¬æ¨¡å‹
   ```dart
   @freezed
   class Sample with _$Sample {
     const factory Sample({
       required int timestamp,
       required int green,
       required int red,
       required int ir,
       required int accX,
       required int accY,
       required int accZ,
       required int gyroX,
       required int gyroY,
       required int gyroZ,
       required int temp0,
       required int temp1,
       required int temp2,
     }) = _Sample;
   }
   
   @freezed
   class SampleBatch with _$SampleBatch {
     const factory SampleBatch({
       required List<Sample> samples,
       required int timestamp,
     }) = _SampleBatch;
   }
   ```

3. **`lib/models/device_info.dart`** - è®¾å¤‡ä¿¡æ¯æ¨¡å‹
   ```dart
   @freezed
   class DeviceInfo with _$DeviceInfo {
     const factory DeviceInfo({
       required String name,
       required String address,
       String? version,
       int? batteryLevel,
       DateTime? lastSyncTime,
     }) = _DeviceInfo;
   }
   ```

**å­ä»»åŠ¡**:
- [ ] åˆ›å»ºæ‰€æœ‰ Freezed æ¨¡å‹
- [ ] è¿è¡Œ `flutter pub run build_runner build`
- [ ] æ›´æ–° `ring_platform.dart` ä½¿ç”¨æ–°æ¨¡å‹
- [ ] æ›´æ–° MainActivity.kt åºåˆ—åŒ–é€»è¾‘

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ‰€æœ‰æ¨¡å‹æ­£ç¡®ç”Ÿæˆ `.freezed.dart` å’Œ `.g.dart`
- âœ… EventChannel äº‹ä»¶å¯æ­£ç¡®ååºåˆ—åŒ–
- âœ… ç±»å‹å®‰å…¨ï¼ˆæ— è¿è¡Œæ—¶ç±»å‹é”™è¯¯ï¼‰

**é¢„è®¡æ—¶é—´**: 0.5 å¤©

---

#### ğŸ“‹ ä»»åŠ¡ 1.3: æµ‹é‡é¡µé¢å®æ—¶æ•°æ®é›†æˆ

**ç›®æ ‡**: å°† Platform Channel æ•°æ®æµè¿æ¥åˆ°æµ‹é‡é¡µé¢ï¼Œå®ç°çœŸå®æ³¢å½¢æ˜¾ç¤ºã€‚

**å­ä»»åŠ¡**:
1. **åˆ›å»º Riverpod Provider**
   ```dart
   // lib/providers/ble_data_provider.dart
   final bleEventStreamProvider = StreamProvider<BleEvent>((ref) {
     return RingPlatform.eventStream;
   });
   
   final currentSamplesProvider = StateProvider<List<Sample>>((ref) => []);
   
   final heartRateProvider = StateProvider<int?>((ref) => null);
   final respiratoryRateProvider = StateProvider<int?>((ref) => null);
   final signalQualityProvider = StateProvider<double>((ref) => 0.0);
   ```

2. **æ›´æ–° MeasurementPage**
   - [ ] ç›‘å¬ `bleEventStreamProvider`
   - [ ] æ¥æ”¶ `SampleBatch` äº‹ä»¶
   - [ ] æ›´æ–° `_ppgGreenData`, `_ppgRedData`, `_ppgIrData`
   - [ ] è§¦å‘æ³¢å½¢é‡ç»˜

3. **å®ç°å¼€å§‹/åœæ­¢é€»è¾‘**
   - [ ] "å¼€å§‹æµ‹é‡" æŒ‰é’®è°ƒç”¨ `RingPlatform.startLiveMeasurement(60)`
   - [ ] "åœæ­¢" æŒ‰é’®è°ƒç”¨ `RingPlatform.stopMeasurement()`
   - [ ] æ ¹æ®è¿æ¥çŠ¶æ€å¯ç”¨/ç¦ç”¨æŒ‰é’®

**éªŒæ”¶æ ‡å‡†**:
- âœ… ç‚¹å‡»"å¼€å§‹æµ‹é‡"åï¼Œæ³¢å½¢å¼€å§‹å®æ—¶æ»šåŠ¨
- âœ… æ³¢å½¢æµç•…ï¼ˆ>= 25 FPSï¼‰
- âœ… æ•°æ®ä¸åŸç”Ÿ App ä¸€è‡´
- âœ… åœæ­¢æµ‹é‡æ­£å¸¸å·¥ä½œ

**é¢„è®¡æ—¶é—´**: 1 å¤©

---

#### ğŸ“‹ ä»»åŠ¡ 1.4: Dashboard é¡µé¢é›†æˆè®¾å¤‡ä¿¡æ¯

**ç›®æ ‡**: åœ¨ Dashboard æ˜¾ç¤ºçœŸå®è®¾å¤‡ä¿¡æ¯ï¼ˆç”µé‡ã€ç‰ˆæœ¬ã€è¿æ¥æ—¶é—´ï¼‰ã€‚

**å­ä»»åŠ¡**:
- [ ] è°ƒç”¨ `RingPlatform.getDeviceInfo()` è·å–è®¾å¤‡ä¿¡æ¯
- [ ] è°ƒç”¨ `RingPlatform.getBatteryLevel()` è·å–ç”µé‡
- [ ] æ›´æ–° Dashboard UI æ˜¾ç¤ºçœŸå®æ•°æ®
- [ ] æ·»åŠ "åŒæ­¥æ—¶é—´"æŒ‰é’®ï¼ˆè°ƒç”¨ `updateDeviceTime()`ï¼‰
- [ ] æ·»åŠ "æ ¡å‡†æ—¶é—´"æŒ‰é’®ï¼ˆè°ƒç”¨ `calibrateTime()`ï¼‰

**éªŒæ”¶æ ‡å‡†**:
- âœ… Dashboard æ˜¾ç¤ºçœŸå®è®¾å¤‡åç§°
- âœ… ç”µé‡æ˜¾ç¤ºæ­£ç¡®ï¼ˆå¸¦å›¾æ ‡å’Œç™¾åˆ†æ¯”ï¼‰
- âœ… è®¾å¤‡ç‰ˆæœ¬æ˜¾ç¤ºæ­£ç¡®
- âœ… æ—¶é—´åŒæ­¥åŠŸèƒ½æ­£å¸¸

**é¢„è®¡æ—¶é—´**: 0.5 å¤©

---

### é˜¶æ®µ 2: ç®—æ³•é›†æˆä¸ç”Ÿç†æŒ‡æ ‡è®¡ç®—ï¼ˆé¢„è®¡ 2-3 å¤©ï¼‰

#### ğŸ“‹ ä»»åŠ¡ 2.1: é›†æˆæˆ–è¿ç§» VitalSignsProcessor

**æ–¹æ¡ˆ A: ä¿æŒåŸç”Ÿç®—æ³•ï¼ˆå¿«é€Ÿæ–¹æ¡ˆï¼‰**
- [ ] åœ¨ MainActivity.kt ä¸­è°ƒç”¨ç°æœ‰ Java çš„ `VitalSignsProcessor`
- [ ] è®¡ç®— HR/RR åé€šè¿‡ EventChannel å‘é€ `VitalSignsUpdate` äº‹ä»¶
- [ ] Dart ä¾§ç›´æ¥æ˜¾ç¤ºç»“æœ

**æ–¹æ¡ˆ B: è¿ç§»åˆ° Dartï¼ˆé•¿æœŸæ–¹æ¡ˆï¼‰**
- [ ] åˆ›å»º `lib/processors/vital_signs_processor.dart`
- [ ] è¿ç§»æ»¤æ³¢ç®—æ³•ï¼ˆå¸¦é€šæ»¤æ³¢ã€ä½é€šæ»¤æ³¢ï¼‰
- [ ] è¿ç§»å³°å€¼æ£€æµ‹ç®—æ³•
- [ ] è¿ç§» HR/RR è®¡ç®—é€»è¾‘
- [ ] ä½¿ç”¨ Isolate å¤„ç†ï¼ˆé¿å…é˜»å¡ UIï¼‰
- [ ] å¯¹æ¯”æµ‹è¯•ï¼ˆDart ç‰ˆ vs Java ç‰ˆï¼Œè¯¯å·® < 5%ï¼‰

**æ¨è**: å…ˆä½¿ç”¨æ–¹æ¡ˆ A å¿«é€Ÿå®ç°ï¼Œåç»­ä¼˜åŒ–æ—¶é‡‡ç”¨æ–¹æ¡ˆ Bã€‚

**éªŒæ”¶æ ‡å‡†**:
- âœ… æµ‹é‡é¡µé¢å®æ—¶æ˜¾ç¤º HR/RR
- âœ… ä¿¡å·è´¨é‡æŒ‡ç¤ºå™¨æ­£å¸¸å·¥ä½œ
- âœ… æ•°å€¼åˆç†ï¼ˆHR: 40-200 BPM, RR: 8-40 RPMï¼‰

**é¢„è®¡æ—¶é—´**: æ–¹æ¡ˆ A: 0.5 å¤© | æ–¹æ¡ˆ B: 2 å¤©

---

#### ğŸ“‹ ä»»åŠ¡ 2.2: ä¿¡å·è´¨é‡è¯„ä¼°ä¸ UI åé¦ˆ

**ç›®æ ‡**: å®ç°ä¿¡å·è´¨é‡å®æ—¶è¯„ä¼°ï¼Œå¹¶åœ¨ UI ä¸Šæä¾›è§†è§‰åé¦ˆã€‚

**å­ä»»åŠ¡**:
- [ ] å®ç°ä¿¡å·è´¨é‡ç®—æ³•ï¼ˆåŸºäº PPG å¹…å€¼ã€æ³¢åŠ¨ã€å™ªå£°ï¼‰
- [ ] å®šä¹‰ 5 çº§è´¨é‡ç­‰çº§ï¼ˆä¼˜ç§€/è‰¯å¥½/ä¸€èˆ¬/å·®/æ— ä¿¡å·ï¼‰
- [ ] æ›´æ–° `_SignalQualityIndicator` ç»„ä»¶
- [ ] æ ¹æ®è´¨é‡æ˜¾ç¤ºä¸åŒé¢œè‰²ï¼ˆç»¿/æ©™/çº¢ï¼‰
- [ ] è´¨é‡å·®æ—¶æ˜¾ç¤ºæç¤ºï¼ˆ"è¯·è°ƒæ•´ä½©æˆ´ä½ç½®"ï¼‰

**éªŒæ”¶æ ‡å‡†**:
- âœ… ä¿¡å·è´¨é‡æŒ‡ç¤ºå™¨å®æ—¶æ›´æ–°
- âœ… è´¨é‡å·®æ—¶æ˜¾ç¤ºå‹å¥½æç¤º
- âœ… è§†è§‰æ•ˆæœæ¸…æ™°ç›´è§‚

**é¢„è®¡æ—¶é—´**: 0.5 å¤©

---

### é˜¶æ®µ 3: ç¦»çº¿å½•åˆ¶åŠŸèƒ½å®ç°ï¼ˆé¢„è®¡ 4-5 å¤©ï¼‰

#### ğŸ“‹ ä»»åŠ¡ 3.1: Platform Channel ç¦»çº¿å½•åˆ¶æ–¹æ³•

**ç›®æ ‡**: åœ¨ MainActivity.kt ä¸­å®ç°ç¦»çº¿å½•åˆ¶ç›¸å…³æ–¹æ³•ã€‚

**å­ä»»åŠ¡**:
1. **å¯åŠ¨ç¦»çº¿å½•åˆ¶**
   - [ ] å®ç° `startOfflineRecording(totalDuration, segmentDuration, samplingMode, autoDisconnect)`
   - [ ] è°ƒç”¨ AAR åº“å‘é€å½•åˆ¶å‘½ä»¤åˆ°æˆ’æŒ‡
   - [ ] å‘é€ `RecordingStarted` äº‹ä»¶

2. **åœæ­¢ç¦»çº¿å½•åˆ¶**
   - [ ] å®ç° `stopOfflineRecording()`
   - [ ] å‘é€åœæ­¢å‘½ä»¤

3. **æ–‡ä»¶ç®¡ç†**
   - [ ] å®ç° `getFileList()` - è·å–æˆ’æŒ‡æ–‡ä»¶åˆ—è¡¨
   - [ ] å®ç° `downloadFile(fileName)` - ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°
   - [ ] å®ç° `deleteFile(fileName)` - åˆ é™¤æˆ’æŒ‡æ–‡ä»¶
   - [ ] å®ç° `formatFileSystem()` - æ ¼å¼åŒ–æˆ’æŒ‡å­˜å‚¨

4. **äº‹ä»¶é€šçŸ¥**
   - [ ] å½•åˆ¶è¿›åº¦äº‹ä»¶ï¼ˆ`RecordingProgress`ï¼‰
   - [ ] å½•åˆ¶å®Œæˆäº‹ä»¶ï¼ˆ`RecordingCompleted`ï¼‰
   - [ ] æ–‡ä»¶ä¸‹è½½è¿›åº¦äº‹ä»¶ï¼ˆ`FileDownloadProgress`ï¼‰
   - [ ] æ–‡ä»¶ä¸‹è½½å®Œæˆäº‹ä»¶ï¼ˆ`FileDownloadCompleted`ï¼‰

**éªŒæ”¶æ ‡å‡†**:
- âœ… å¯å¯åŠ¨ç¦»çº¿å½•åˆ¶ï¼ˆæˆ’æŒ‡ LED é—ªçƒç¡®è®¤ï¼‰
- âœ… å¯è·å–æ–‡ä»¶åˆ—è¡¨
- âœ… å¯ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°
- âœ… äº‹ä»¶æ­£å¸¸è§¦å‘

**é¢„è®¡æ—¶é—´**: 1-2 å¤©

---

#### ğŸ“‹ ä»»åŠ¡ 3.2: æ•°æ®æºæŠ½è±¡å±‚å®ç°

**ç›®æ ‡**: å®ç°ç»Ÿä¸€çš„æ•°æ®æºæ¥å£ï¼Œæ”¯æŒåœ¨çº¿/ç¦»çº¿/æœ¬åœ°æ–‡ä»¶ä¸‰ç§æ¨¡å¼ã€‚

**æ–‡ä»¶åˆ›å»º**:
1. **`lib/services/sensor_data_source.dart`** - æŠ½è±¡æ¥å£
2. **`lib/services/live_ble_source.dart`** - åœ¨çº¿ BLE æ•°æ®æº
3. **`lib/services/offline_recording_source.dart`** - ç¦»çº¿å½•åˆ¶æ•°æ®æº
4. **`lib/services/local_file_source.dart`** - æœ¬åœ°æ–‡ä»¶æ•°æ®æº

**æ ¸å¿ƒé€»è¾‘ - OfflineRecordingSource**:
```dart
enum RecordingPhase {
  idle,
  scheduling,      // å‘é€å¯åŠ¨å‘½ä»¤
  recording,       // æˆ’æŒ‡é‡‡é›†ä¸­ï¼ˆå¯æ–­è¿ï¼‰
  waitingDownload, // é‡‡é›†å®Œæˆï¼Œç­‰å¾…ä¸‹è½½
  downloading,     // ä¸‹è½½ä¸­
  readyForPlayback,// å·²ä¸‹è½½ï¼Œå‡†å¤‡å›æ”¾
  playingBack,     // å›æ”¾ä¸­
}

class OfflineRecordingDataSource implements SensorDataSource {
  @override
  Future<void> start(SourceConfig config) async {
    // 1. å‘é€å½•åˆ¶å‘½ä»¤
    await _platform.startOfflineRecording(...);
    _phase = RecordingPhase.recording;
    
    // 2. å¯é€‰ï¼šè‡ªåŠ¨æ–­è¿çœç”µ
    if (config.autoDisconnect) {
      await Future.delayed(Duration(seconds: 2));
      await _platform.disconnect();
    }
    
    // 3. è®¾ç½®è‡ªåŠ¨ä¸‹è½½å®šæ—¶å™¨
    _scheduleAutoDownload(config.duration);
  }
  
  void _scheduleAutoDownload(int duration) {
    _timer = Timer(Duration(seconds: duration + 10), () async {
      _phase = RecordingPhase.waitingDownload;
      
      // 4. é‡è¿æˆ’æŒ‡
      await _platform.connectDevice(savedMacAddress);
      
      // 5. è·å–æ–‡ä»¶åˆ—è¡¨
      final files = await _platform.getFileList();
      
      // 6. æ‰¾åˆ°æœ€æ–°æ–‡ä»¶
      final latestFile = _findLatestFile(files);
      
      // 7. ä¸‹è½½æ–‡ä»¶
      await _platform.downloadFile(latestFile.fileName);
      
      // 8. å¼€å§‹å›æ”¾
      _phase = RecordingPhase.playingBack;
      await _playbackFile(latestFile.localPath);
    });
  }
  
  Future<void> _playbackFile(String filePath) async {
    final samples = await _parseFile(filePath);
    
    // æŒ‰æ—¶é—´æˆ³æ¨¡æ‹Ÿå®æ—¶æµ
    for (var batch in _batchSamples(samples, 25)) {
      _sampleController.add(batch);
      await Future.delayed(Duration(milliseconds: 40)); // 25Hz
    }
  }
}
```

**å­ä»»åŠ¡**:
- [ ] å®ç° `SensorDataSource` æ¥å£
- [ ] å®ç° `LiveBleDataSource`ï¼ˆå·²åŸºæœ¬å®Œæˆï¼‰
- [ ] å®ç° `OfflineRecordingDataSource`ï¼ˆæ ¸å¿ƒï¼‰
- [ ] å®ç° `LocalFileDataSource`ï¼ˆæ–‡ä»¶è§£æä¸å›æ”¾ï¼‰
- [ ] å®ç°æ–‡ä»¶è§£æé€»è¾‘ï¼ˆå‚è€ƒåŸ Java ä»£ç æ ¼å¼ï¼‰

**éªŒæ”¶æ ‡å‡†**:
- âœ… å¯å¯åŠ¨ç¦»çº¿å½•åˆ¶å¹¶æ–­è¿
- âœ… å®šæ—¶å™¨è§¦å‘è‡ªåŠ¨ä¸‹è½½
- âœ… æ–‡ä»¶ä¸‹è½½æˆåŠŸ
- âœ… å›æ”¾æ­£å¸¸ï¼Œæ•°æ®ä¸åŸç”Ÿä¸€è‡´

**é¢„è®¡æ—¶é—´**: 2-3 å¤©

---

#### ğŸ“‹ ä»»åŠ¡ 3.3: æµ‹é‡é¡µé¢é›†æˆç¦»çº¿æ¨¡å¼

**ç›®æ ‡**: åœ¨æµ‹é‡é¡µé¢æ·»åŠ æ•°æ®æºé€‰æ‹©å™¨ï¼Œæ”¯æŒåˆ‡æ¢åœ¨çº¿/ç¦»çº¿æ¨¡å¼ã€‚

**å­ä»»åŠ¡**:
1. **æ•°æ®æºé€‰æ‹©å™¨**
   - [ ] æ›´æ–° `_DataSourceSelector` ç»„ä»¶
   - [ ] æ”¯æŒé€‰æ‹©ï¼šå®æ—¶æµ‹é‡ï¼ˆåœ¨çº¿ï¼‰ã€æˆ’æŒ‡å½•åˆ¶ï¼ˆç¦»çº¿ï¼‰ã€æœ¬åœ°æ–‡ä»¶å›æ”¾
   - [ ] åˆ‡æ¢æ—¶æ›´æ–° `currentDataSourceProvider`

2. **ç¦»çº¿çŠ¶æ€å¡ç‰‡**
   - [ ] æ›´æ–° `_OfflineStatusCard` ç»„ä»¶
   - [ ] æ˜¾ç¤ºå½“å‰å½•åˆ¶é˜¶æ®µï¼ˆ8 ç§çŠ¶æ€ï¼‰
   - [ ] æ˜¾ç¤ºè¿›åº¦æ¡ï¼ˆå½•åˆ¶è¿›åº¦ã€ä¸‹è½½è¿›åº¦ï¼‰
   - [ ] æ˜¾ç¤ºå‰©ä½™æ—¶é—´
   - [ ] æ·»åŠ "æ–­å¼€è¿æ¥ï¼ˆçœç”µï¼‰"æŒ‰é’®
   - [ ] æ·»åŠ "ç«‹å³ä¸‹è½½"æŒ‰é’®

3. **é…ç½®å¯¹è¯æ¡†**
   - [ ] åˆ›å»ºå½•åˆ¶é…ç½®å¯¹è¯æ¡†ï¼ˆæ€»æ—¶é•¿ã€åˆ†æ®µæ—¶é•¿ã€é‡‡æ ·æ¨¡å¼ã€è‡ªåŠ¨æ–­è¿ï¼‰
   - [ ] ç‚¹å‡»"å¼€å§‹æµ‹é‡"æ—¶æ ¹æ®æ•°æ®æºæ˜¾ç¤ºä¸åŒé…ç½®

**éªŒæ”¶æ ‡å‡†**:
- âœ… å¯é€‰æ‹©ä¸åŒæ•°æ®æº
- âœ… ç¦»çº¿æ¨¡å¼çŠ¶æ€å¡ç‰‡æ­£ç¡®æ˜¾ç¤º
- âœ… å½•åˆ¶é…ç½®æ­£å¸¸å·¥ä½œ
- âœ… æ–­è¿åä»å¯æ˜¾ç¤ºçŠ¶æ€

**é¢„è®¡æ—¶é—´**: 1 å¤©

---

### é˜¶æ®µ 4: æ–‡ä»¶ç®¡ç†ä¸å†å²è®°å½•ï¼ˆé¢„è®¡ 2-3 å¤©ï¼‰

#### ğŸ“‹ ä»»åŠ¡ 4.1: æ–‡ä»¶ç®¡ç†åŠŸèƒ½

**ç›®æ ‡**: å®ç°å®Œæ•´çš„æ–‡ä»¶ç®¡ç†åŠŸèƒ½ï¼ˆåˆ—è¡¨ã€ä¸‹è½½ã€åˆ é™¤ã€å›æ”¾ï¼‰ã€‚

**å­ä»»åŠ¡**:
- [ ] åˆ›å»ºæ–‡ä»¶åˆ—è¡¨é¡µé¢ï¼ˆå¯åœ¨ Settings æˆ–æ–°å»ºç‹¬ç«‹é¡µé¢ï¼‰
- [ ] æ˜¾ç¤ºæˆ’æŒ‡æ–‡ä»¶åˆ—è¡¨ï¼ˆæ–‡ä»¶åã€å¤§å°ã€æ—¥æœŸï¼‰
- [ ] å®ç°ä¸‹è½½åŠŸèƒ½ï¼ˆè¿›åº¦æ¡æ˜¾ç¤ºï¼‰
- [ ] å®ç°åˆ é™¤åŠŸèƒ½ï¼ˆç¡®è®¤å¯¹è¯æ¡†ï¼‰
- [ ] å®ç°å›æ”¾åŠŸèƒ½ï¼ˆé€‰æ‹©æ–‡ä»¶åè·³è½¬åˆ°æµ‹é‡é¡µé¢ï¼‰
- [ ] å®ç°æ ¼å¼åŒ–å­˜å‚¨åŠŸèƒ½

**éªŒæ”¶æ ‡å‡†**:
- âœ… å¯æŸ¥çœ‹æˆ’æŒ‡æ–‡ä»¶åˆ—è¡¨
- âœ… å¯ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°
- âœ… å¯åˆ é™¤æˆ’æŒ‡æ–‡ä»¶
- âœ… å¯å›æ”¾æœ¬åœ°æ–‡ä»¶

**é¢„è®¡æ—¶é—´**: 1-1.5 å¤©

---

#### ğŸ“‹ ä»»åŠ¡ 4.2: å†å²è®°å½•ä¸æ•°æ®æŒä¹…åŒ–

**ç›®æ ‡**: ä¿å­˜æµ‹é‡è®°å½•åˆ°æœ¬åœ°æ•°æ®åº“ï¼Œå®ç°å†å²è®°å½•æŸ¥çœ‹ã€‚

**å­ä»»åŠ¡**:
1. **æ•°æ®åº“è®¾è®¡**
   - [ ] ä½¿ç”¨ `sqflite` åˆ›å»ºæœ¬åœ°æ•°æ®åº“
   - [ ] è®¾è®¡è¡¨ç»“æ„ï¼ˆMeasurementRecord è¡¨ï¼‰
   ```sql
   CREATE TABLE measurement_records (
     id INTEGER PRIMARY KEY AUTOINCREMENT,
     start_time INTEGER NOT NULL,
     end_time INTEGER,
     duration INTEGER,
     source_type TEXT NOT NULL,  -- 'live', 'offline', 'local_file'
     avg_heart_rate INTEGER,
     max_heart_rate INTEGER,
     min_heart_rate INTEGER,
     avg_respiratory_rate INTEGER,
     file_path TEXT,
     note TEXT
   );
   ```

2. **è®°å½•ä¿å­˜**
   - [ ] æµ‹é‡ç»“æŸæ—¶ä¿å­˜è®°å½•
   - [ ] ä¿å­˜ç»Ÿè®¡æŒ‡æ ‡ï¼ˆHR/RR å¹³å‡å€¼ã€æœ€å¤§æœ€å°å€¼ï¼‰
   - [ ] å…³è”æ–‡ä»¶è·¯å¾„ï¼ˆå¦‚æœæ˜¯ç¦»çº¿/æœ¬åœ°æ–‡ä»¶ï¼‰

3. **å†å²é¡µé¢å®Œå–„**
   - [ ] ä»æ•°æ®åº“åŠ è½½å†å²è®°å½•
   - [ ] æ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡
   - [ ] æ”¯æŒåˆ é™¤è®°å½•
   - [ ] æ”¯æŒé‡æ–°å›æ”¾ï¼ˆç‚¹å‡»è®°å½•è·³è½¬æµ‹é‡é¡µé¢ï¼‰

**éªŒæ”¶æ ‡å‡†**:
- âœ… æµ‹é‡è®°å½•æ­£ç¡®ä¿å­˜
- âœ… å†å²é¡µé¢æ˜¾ç¤ºçœŸå®æ•°æ®
- âœ… å¯æŸ¥çœ‹è¯¦ç»†ç»Ÿè®¡
- âœ… å¯é‡æ–°å›æ”¾å†å²è®°å½•

**é¢„è®¡æ—¶é—´**: 1-1.5 å¤©

---

### é˜¶æ®µ 5: åå°ä»»åŠ¡ä¸é€šçŸ¥ï¼ˆé¢„è®¡ 1-2 å¤©ï¼‰

#### ğŸ“‹ ä»»åŠ¡ 5.1: åå°ä»»åŠ¡ä¸é€šçŸ¥

**ç›®æ ‡**: å®ç°ç¦»çº¿å½•åˆ¶å®Œæˆåçš„åå°ä¸‹è½½ä¸é€šçŸ¥æé†’ã€‚

**å­ä»»åŠ¡**:
1. **æœ¬åœ°é€šçŸ¥**
   - [ ] é›†æˆ `flutter_local_notifications`
   - [ ] å½•åˆ¶å®Œæˆæ—¶å‘é€é€šçŸ¥ï¼ˆ"ç¦»çº¿é‡‡é›†å·²å®Œæˆï¼Œå¯ä»¥ä¸‹è½½äº†"ï¼‰
   - [ ] ç‚¹å‡»é€šçŸ¥æ‰“å¼€ App å¹¶è·³è½¬åˆ°æµ‹é‡é¡µé¢

2. **åå°ä»»åŠ¡ï¼ˆå¯é€‰ï¼‰**
   - [ ] é›†æˆ `workmanager`
   - [ ] å®šæ—¶æ£€æŸ¥æ˜¯å¦æœ‰å¾…ä¸‹è½½æ–‡ä»¶
   - [ ] åå°è‡ªåŠ¨ä¸‹è½½ï¼ˆéœ€æƒé™ï¼‰

3. **çŠ¶æ€æŒä¹…åŒ–**
   - [ ] ä½¿ç”¨ `shared_preferences` ä¿å­˜ç¦»çº¿å½•åˆ¶çŠ¶æ€
   - [ ] App è¢«æ€åé‡å¯ï¼Œæ¢å¤å½•åˆ¶çŠ¶æ€
   - [ ] æ˜¾ç¤º"æœ‰æœªå®Œæˆçš„å½•åˆ¶"æç¤º

**éªŒæ”¶æ ‡å‡†**:
- âœ… å½•åˆ¶å®Œæˆåæ”¶åˆ°é€šçŸ¥
- âœ… ç‚¹å‡»é€šçŸ¥æ­£ç¡®è·³è½¬
- âœ… App é‡å¯åçŠ¶æ€æ¢å¤

**é¢„è®¡æ—¶é—´**: 1-2 å¤©

---

### é˜¶æ®µ 6: æ€§èƒ½ä¼˜åŒ–ä¸æµ‹è¯•ï¼ˆé¢„è®¡ 3-4 å¤©ï¼‰

#### ğŸ“‹ ä»»åŠ¡ 6.1: æ€§èƒ½ä¼˜åŒ–

**ä¼˜åŒ–ç›®æ ‡**:
| æŒ‡æ ‡ | ç›®æ ‡ | ä¼˜åŒ–æ–¹æ¡ˆ |
|------|------|----------|
| å¸§ç‡ | >= 60 FPS | é™é‡‡æ ·ã€æ‰¹é‡ç»˜åˆ¶ã€ä½¿ç”¨ RepaintBoundary |
| å†…å­˜ | < 100 MB | é™åˆ¶ç¼“å†²åŒºå¤§å°ã€åŠæ—¶é‡Šæ”¾èµ„æº |
| å¯åŠ¨æ—¶é—´ | < 2 ç§’ | å»¶è¿ŸåŠ è½½ã€å‡å°‘åˆå§‹åŒ– |
| BLE å»¶è¿Ÿ | < 50 ms | ä¼˜åŒ– Channel é€šä¿¡ã€å‡å°‘åºåˆ—åŒ–å¼€é”€ |

**å­ä»»åŠ¡**:
- [ ] ä½¿ç”¨ Flutter DevTools åˆ†ææ€§èƒ½ç“¶é¢ˆ
- [ ] ä¼˜åŒ–æ³¢å½¢ç»˜åˆ¶ï¼ˆé™é‡‡æ ·ã€ä»…ç»˜åˆ¶å¯è§åŒºåŸŸï¼‰
- [ ] ä½¿ç”¨ Isolate å¤„ç†ç®—æ³•è®¡ç®—
- [ ] å‡å°‘ä¸å¿…è¦çš„ Widget é‡å»ºï¼ˆä½¿ç”¨ `const`ã€`ValueListenableBuilder`ï¼‰
- [ ] ä¼˜åŒ–å†…å­˜å ç”¨ï¼ˆé™åˆ¶æ ·æœ¬ç¼“å†²åŒºå¤§å°ï¼‰

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ³¢å½¢ç»˜åˆ¶ >= 60 FPS
- âœ… å†…å­˜å ç”¨ < 100 MB
- âœ… å¯åŠ¨æ—¶é—´ < 2 ç§’

**é¢„è®¡æ—¶é—´**: 1-2 å¤©

---

#### ğŸ“‹ ä»»åŠ¡ 6.2: æµ‹è¯•ä¸ Bug ä¿®å¤

**æµ‹è¯•åœºæ™¯**:
1. **åŠŸèƒ½æµ‹è¯•**
   - [ ] åœ¨çº¿æµ‹é‡å®Œæ•´æµç¨‹
   - [ ] ç¦»çº¿å½•åˆ¶å®Œæ•´æµç¨‹ï¼ˆå¯åŠ¨â†’æ–­è¿â†’ä¸‹è½½â†’å›æ”¾ï¼‰
   - [ ] æœ¬åœ°æ–‡ä»¶å›æ”¾
   - [ ] æ–‡ä»¶ç®¡ç†ï¼ˆåˆ—è¡¨/ä¸‹è½½/åˆ é™¤ï¼‰
   - [ ] å†å²è®°å½•æŸ¥çœ‹

2. **å¼‚å¸¸åœºæ™¯æµ‹è¯•**
   - [ ] æµ‹é‡ä¸­é€”æ–­è¿ï¼ˆåœ¨çº¿æ¨¡å¼ï¼‰
   - [ ] é‡è¿å¤±è´¥ï¼ˆç¦»çº¿æ¨¡å¼ï¼‰
   - [ ] æ–‡ä»¶ä¸‹è½½å¤±è´¥
   - [ ] App è¢«æ€åæ¢å¤çŠ¶æ€
   - [ ] æˆ’æŒ‡ç”µé‡è€—å°½

3. **å…¼å®¹æ€§æµ‹è¯•**
   - [ ] æµ‹è¯•è‡³å°‘ 3 æ¬¾ä¸åŒå“ç‰Œ Android æ‰‹æœº
   - [ ] æµ‹è¯•ä¸åŒ Android ç‰ˆæœ¬ï¼ˆ8.0, 10.0, 12.0, 14.0ï¼‰

**éªŒæ”¶æ ‡å‡†**:
- âœ… æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸
- âœ… å¼‚å¸¸åœºæ™¯æœ‰å‹å¥½æç¤º
- âœ… æ— å´©æºƒã€æ— å†…å­˜æ³„æ¼

**é¢„è®¡æ—¶é—´**: 1-2 å¤©

---

### é˜¶æ®µ 7: æ‰“åŒ…ä¸å‘å¸ƒï¼ˆé¢„è®¡ 1 å¤©ï¼‰

#### ğŸ“‹ ä»»åŠ¡ 7.1: æ‰“åŒ… APK

**å­ä»»åŠ¡**:
- [ ] é…ç½®ç­¾åå¯†é’¥
- [ ] ä¼˜åŒ– ProGuard è§„åˆ™
- [ ] ç”Ÿæˆ Release APK
  ```bash
  flutter build apk --release
  ```
- [ ] æµ‹è¯• Release ç‰ˆæœ¬

**éªŒæ”¶æ ‡å‡†**:
- âœ… APK å¤§å° < 50 MB
- âœ… Release ç‰ˆæœ¬åŠŸèƒ½æ­£å¸¸
- âœ… æ— æ··æ·†å¯¼è‡´çš„å´©æºƒ

**é¢„è®¡æ—¶é—´**: 0.5 å¤©

---

## ğŸ”® åç»­ä¼˜åŒ–é˜¶æ®µï¼ˆV2.0ï¼‰

> **è¯´æ˜**: è¿™äº›ä»»åŠ¡åœ¨ç¬¬ä¸€ç‰ˆå®Œæˆåè¿›è¡Œï¼ŒæŒ‰ä¼˜å…ˆçº§é€æ­¥å®æ–½

### é˜¶æ®µ 8: ç®—æ³•è¿ç§»åˆ° Dartï¼ˆé¢„è®¡ 5-7 å¤©ï¼‰

**ç›®æ ‡**: å°† Java ç‰ˆ VitalSignsProcessor è¿ç§»åˆ° Dartï¼Œå®ç°è·¨å¹³å°æ”¯æŒ

#### ğŸ“‹ ä»»åŠ¡ 8.1: Dart ç®—æ³•å®ç°

**å­ä»»åŠ¡**:
1. **åˆ›å»º Dart ç‰ˆå¤„ç†å™¨**
   - [ ] åˆ›å»º `lib/processors/vital_signs_processor_dart.dart`
   - [ ] å®ç°å¸¦é€šæ»¤æ³¢ç®—æ³•ï¼ˆButterworth æˆ– IIRï¼‰
   - [ ] å®ç°å³°å€¼æ£€æµ‹ç®—æ³•
   - [ ] å®ç°å¿ƒç‡è®¡ç®—é€»è¾‘
   - [ ] å®ç°å‘¼å¸ç‡è®¡ç®—é€»è¾‘

2. **Isolate é›†æˆ**
   - [ ] åˆ›å»ºç‹¬ç«‹ Isolate å¤„ç†ç®—æ³•ï¼ˆé¿å…é˜»å¡ UIï¼‰
   - [ ] å®ç°ä¸»çº¿ç¨‹ä¸ Isolate é€šä¿¡
   - [ ] ä¼˜åŒ–å†…å­˜å ç”¨

3. **å¯¹æ¯”æµ‹è¯•**
   - [ ] ä½¿ç”¨ç›¸åŒæµ‹è¯•æ•°æ®å¯¹æ¯” Java ç‰ˆå’Œ Dart ç‰ˆ
   - [ ] ç¡®ä¿è¯¯å·® < 5%
   - [ ] æ€§èƒ½æµ‹è¯•ï¼ˆCPU å ç”¨ã€å»¶è¿Ÿï¼‰

**éªŒæ”¶æ ‡å‡†**:
- âœ… Dart ç‰ˆç®—æ³•ä¸ Java ç‰ˆç»“æœä¸€è‡´ï¼ˆè¯¯å·® < 5%ï¼‰
- âœ… æ€§èƒ½å¯æ¥å—ï¼ˆCPU < 15%ï¼Œå»¶è¿Ÿ < 100msï¼‰
- âœ… æ—  UI å¡é¡¿

**é¢„è®¡æ—¶é—´**: 3-4 å¤©

---

#### ğŸ“‹ ä»»åŠ¡ 8.2: ç®—æ³•åˆ‡æ¢ä¸é…ç½®

**ç›®æ ‡**: å…è®¸ç”¨æˆ·æˆ–å¼€å‘è€…åœ¨ Java å’Œ Dart ç®—æ³•é—´åˆ‡æ¢

**å­ä»»åŠ¡**:
- [ ] åˆ›å»ºç®—æ³•é€‰æ‹©é…ç½®ï¼ˆå¼€å‘è€…é€‰é¡¹ï¼‰
- [ ] å®ç°è¿è¡Œæ—¶åˆ‡æ¢é€»è¾‘
- [ ] æ·»åŠ æ€§èƒ½ç›‘æ§ï¼ˆå¯¹æ¯”ä¸¤ç§ç®—æ³•ï¼‰
- [ ] æ–‡æ¡£åŒ–ç®—æ³•å·®å¼‚

**éªŒæ”¶æ ‡å‡†**:
- âœ… å¯åœ¨è®¾ç½®ä¸­åˆ‡æ¢ç®—æ³•
- âœ… åˆ‡æ¢æ— å´©æºƒ
- âœ… æ€§èƒ½å¯¹æ¯”æ•°æ®æ¸…æ™°

**é¢„è®¡æ—¶é—´**: 1 å¤©

---

#### ğŸ“‹ ä»»åŠ¡ 8.3: iOS é€‚é…å‡†å¤‡

**ç›®æ ‡**: ä¸º iOS å¹³å°å‡†å¤‡ç®—æ³•åŸºç¡€

**å­ä»»åŠ¡**:
- [ ] éªŒè¯ Dart ç®—æ³•åœ¨ iOS æ¨¡æ‹Ÿå™¨è¿è¡Œ
- [ ] åˆ›å»º iOS Platform Channelï¼ˆå ä½ï¼‰
- [ ] æµ‹è¯• iOS çœŸæœºæ€§èƒ½

**éªŒæ”¶æ ‡å‡†**:
- âœ… iOS å¯ä½¿ç”¨ Dart ç®—æ³•è®¡ç®— HR/RR
- âœ… æ€§èƒ½ä¸ Android ç›¸å½“

**é¢„è®¡æ—¶é—´**: 1-2 å¤©

---

### é˜¶æ®µ 9: åå°ä»»åŠ¡ä¸æ™ºèƒ½ä¸‹è½½ï¼ˆé¢„è®¡ 3-4 å¤©ï¼‰

**ç›®æ ‡**: å®ç°ç¦»çº¿å½•åˆ¶å®Œæˆåçš„è‡ªåŠ¨ä¸‹è½½ä¸é€šçŸ¥

#### ğŸ“‹ ä»»åŠ¡ 9.1: WorkManager åå°ä»»åŠ¡

**å­ä»»åŠ¡**:
1. **é›†æˆ WorkManager**
   - [ ] æ·»åŠ  `workmanager: ^0.5.2` ä¾èµ–
   - [ ] é…ç½® Android Manifest æƒé™
     ```xml
     <uses-permission android:name="android.permission.RECEIVE_BOOT_COMPLETED" />
     <uses-permission android:name="android.permission.WAKE_LOCK" />
     ```
   - [ ] åˆ›å»ºåå°ä»»åŠ¡å¤„ç†å™¨

2. **å®šæ—¶ä»»åŠ¡è°ƒåº¦**
   - [ ] å½•åˆ¶å¯åŠ¨æ—¶æ³¨å†Œå»¶æ—¶ä»»åŠ¡
   - [ ] ä»»åŠ¡è§¦å‘æ—¶è‡ªåŠ¨è¿æ¥æˆ’æŒ‡
   - [ ] è‡ªåŠ¨ä¸‹è½½æœ€æ–°æ–‡ä»¶
   - [ ] ä¸‹è½½å®Œæˆå‘é€é€šçŸ¥

3. **é”™è¯¯å¤„ç†**
   - [ ] è¿æ¥å¤±è´¥é‡è¯•æœºåˆ¶ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰
   - [ ] é‡è¯•é—´éš”é€’å¢ï¼ˆ1min â†’ 5min â†’ 15minï¼‰
   - [ ] å¤±è´¥åé™çº§ä¸ºæ™®é€šé€šçŸ¥

**ä»£ç ç¤ºä¾‹**:
```dart
// æ³¨å†Œåå°ä»»åŠ¡
void scheduleAutoDownload(int durationMinutes) {
  Workmanager().registerOneOffTask(
    "download_${DateTime.now().millisecondsSinceEpoch}",
    "downloadOfflineData",
    initialDelay: Duration(minutes: durationMinutes + 2),
    constraints: Constraints(
      networkType: NetworkType.not_required,
      requiresBatteryNotLow: true,
    ),
  );
}

// åå°ä»»åŠ¡æ‰§è¡Œ
@pragma('vm:entry-point')
void callbackDispatcher() {
  Workmanager().executeTask((task, inputData) async {
    try {
      // 1. è¿æ¥æˆ’æŒ‡
      await RingPlatform.connectDevice(inputData['macAddress']);
      
      // 2. è·å–æ–‡ä»¶åˆ—è¡¨
      final files = await RingPlatform.getFileList();
      final targetFile = _findLatestFile(files, inputData['timestamp']);
      
      // 3. ä¸‹è½½æ–‡ä»¶
      if (targetFile != null) {
        await RingPlatform.downloadFile(targetFile.fileName);
        await _showSuccessNotification();
        return true;
      }
    } catch (e) {
      await _showRetryNotification();
      return false;
    }
  });
}
```

**éªŒæ”¶æ ‡å‡†**:
- âœ… App è¢«æ€åï¼Œåå°ä»»åŠ¡ä»èƒ½è§¦å‘
- âœ… è‡ªåŠ¨ä¸‹è½½æˆåŠŸç‡ > 90%
- âœ… å¤±è´¥æ—¶æœ‰å‹å¥½æç¤º

**é¢„è®¡æ—¶é—´**: 2-3 å¤©

---

#### ğŸ“‹ ä»»åŠ¡ 9.2: æ™ºèƒ½ä¸‹è½½ç­–ç•¥

**ç›®æ ‡**: ä¼˜åŒ–ä¸‹è½½æ—¶æœºå’Œç­–ç•¥

**å­ä»»åŠ¡**:
- [ ] æ£€æµ‹è®¾å¤‡æ˜¯å¦åœ¨é™„è¿‘ï¼ˆRSSI ä¿¡å·å¼ºåº¦ï¼‰
- [ ] WiFi æ—¶ä¼˜å…ˆä¸‹è½½ï¼ˆèŠ‚çœæµé‡ï¼‰
- [ ] ç”µé‡ä½æ—¶æ¨è¿Ÿä¸‹è½½
- [ ] ç”¨æˆ·å¯è‡ªå®šä¹‰ä¸‹è½½ç­–ç•¥ï¼ˆç«‹å³/WiFi/æ‰‹åŠ¨ï¼‰

**éªŒæ”¶æ ‡å‡†**:
- âœ… ä¸‹è½½ç­–ç•¥å¯é…ç½®
- âœ… çœç”µæ¨¡å¼ä¸‹ä¸ä¼šé¢‘ç¹å”¤é†’
- âœ… ç”¨æˆ·ä½“éªŒè‰¯å¥½

**é¢„è®¡æ—¶é—´**: 1 å¤©

---

### é˜¶æ®µ 10: iOS å¹³å°æ”¯æŒï¼ˆé¢„è®¡ 2-3 å‘¨ï¼‰

> **å‰æ**: é˜¶æ®µ 8ï¼ˆDart ç®—æ³•ï¼‰å·²å®Œæˆ

#### ğŸ“‹ ä»»åŠ¡ 10.1: iOS Platform Channel

**å­ä»»åŠ¡**:
- [ ] åˆ›å»º iOS ç«¯ MethodChannel å®ç°ï¼ˆSwiftï¼‰
- [ ] åˆ›å»º iOS ç«¯ EventChannel å®ç°
- [ ] é›†æˆ iOS CoreBluetooth æ¡†æ¶
- [ ] å®ç°æ‰«æ/è¿æ¥/æ–­è¿é€»è¾‘

**é¢„è®¡æ—¶é—´**: 1 å‘¨

---

#### ğŸ“‹ ä»»åŠ¡ 10.2: iOS åŠŸèƒ½é€‚é…

**å­ä»»åŠ¡**:
- [ ] å®ç°åœ¨çº¿æµ‹é‡
- [ ] å®ç°ç¦»çº¿å½•åˆ¶
- [ ] å®ç°æ–‡ä»¶ç®¡ç†
- [ ] iOS æƒé™é…ç½®ï¼ˆInfo.plistï¼‰

**é¢„è®¡æ—¶é—´**: 1 å‘¨

---

#### ğŸ“‹ ä»»åŠ¡ 10.3: iOS æµ‹è¯•ä¸ä¼˜åŒ–

**å­ä»»åŠ¡**:
- [ ] iPhone çœŸæœºæµ‹è¯•ï¼ˆè‡³å°‘ 3 æ¬¾ï¼‰
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆå†…å­˜ã€ç”µé‡ï¼‰
- [ ] UI é€‚é…ï¼ˆåˆ˜æµ·å±ã€åŠ¨æ€å²›ï¼‰

**é¢„è®¡æ—¶é—´**: 3-5 å¤©

---

## ğŸ“Š å®Œæ•´è¿›åº¦æ€»è§ˆ

### V1.0ï¼ˆåŸºç¡€ç‰ˆæœ¬ï¼‰

| é˜¶æ®µ | é¢„è®¡æ—¶é—´ | ä»»åŠ¡æ•° | çŠ¶æ€ |
|------|----------|--------|------|
| âœ… é˜¶æ®µ 0: å‡†å¤‡å·¥ä½œ | 3 å¤© | 3 | **å·²å®Œæˆ** |
| ğŸŸ¡ é˜¶æ®µ 1: Platform Channel å®Œå–„ | 3-4 å¤© | 4 | **è¿›è¡Œä¸­** |
| âšª é˜¶æ®µ 2: ç®—æ³•é›†æˆï¼ˆJava ç‰ˆï¼‰ | 2-3 å¤© | 2 | å¾…å¼€å§‹ |
| âšª é˜¶æ®µ 3: ç¦»çº¿å½•åˆ¶ | 4-5 å¤© | 3 | å¾…å¼€å§‹ |
| âšª é˜¶æ®µ 4: æ–‡ä»¶ç®¡ç†ä¸å†å² | 2-3 å¤© | 2 | å¾…å¼€å§‹ |
| âšª é˜¶æ®µ 5: é€šçŸ¥åŠŸèƒ½ | 1-2 å¤© | 1 | å¾…å¼€å§‹ |
| âšª é˜¶æ®µ 6: æ€§èƒ½ä¼˜åŒ–ä¸æµ‹è¯• | 3-4 å¤© | 2 | å¾…å¼€å§‹ |
| âšª é˜¶æ®µ 7: æ‰“åŒ…å‘å¸ƒ | 1 å¤© | 1 | å¾…å¼€å§‹ |
| **V1.0 å°è®¡** | **19-27 å¤© (~4-5 å‘¨)** | **18** | **è¿›åº¦ ~20%** |

### V2.0ï¼ˆåç»­ä¼˜åŒ–ï¼‰

| é˜¶æ®µ | é¢„è®¡æ—¶é—´ | ä»»åŠ¡æ•° | çŠ¶æ€ |
|------|----------|--------|------|
| âšª é˜¶æ®µ 8: ç®—æ³•è¿ç§»åˆ° Dart | 5-7 å¤© | 3 | è®¡åˆ’ä¸­ |
| âšª é˜¶æ®µ 9: åå°ä»»åŠ¡ä¸æ™ºèƒ½ä¸‹è½½ | 3-4 å¤© | 2 | è®¡åˆ’ä¸­ |
| âšª é˜¶æ®µ 10: iOS å¹³å°æ”¯æŒ | 2-3 å‘¨ | 3 | è®¡åˆ’ä¸­ |
| **V2.0 å°è®¡** | **3-4 å‘¨** | **8** | **å¾…è§„åˆ’** |

### æ€»è®¡

- **V1.0ï¼ˆAndroid åŸºç¡€ç‰ˆï¼‰**: 19-27 å¤©
- **V2.0ï¼ˆè·¨å¹³å°ä¼˜åŒ–ç‰ˆï¼‰**: é¢å¤– 3-4 å‘¨
- **å®Œæ•´åŠŸèƒ½**: çº¦ 2-2.5 ä¸ªæœˆ

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨ï¼ˆéœ€ç”¨æˆ·ç¡®è®¤ï¼‰

### ç«‹å³æ‰§è¡Œï¼ˆé˜¶æ®µ 1ï¼‰

**ä»»åŠ¡ 1.1: å®Œå–„ MainActivity.kt**ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
1. éªŒè¯ç°æœ‰æ‰«æ/è¿æ¥åŠŸèƒ½
2. å®ç° `startLiveMeasurement` æ–¹æ³•
3. å®ç°å®æ—¶æ•°æ®æµè§£æ
4. å‘é€ `SampleBatch` äº‹ä»¶åˆ° Dart

**ä»»åŠ¡ 1.2: æ•°æ®æ¨¡å‹åˆ›å»º**
1. åˆ›å»º Freezed æ¨¡å‹ï¼ˆ`ble_event.dart`, `sample.dart`, `device_info.dart`ï¼‰
2. è¿è¡Œ build_runner
3. æ›´æ–° Platform æ¥å£

**ä»»åŠ¡ 1.3: æµ‹é‡é¡µé¢æ•°æ®é›†æˆ**
1. åˆ›å»º Provider
2. ç›‘å¬ EventStream
3. æ›´æ–°æ³¢å½¢æ˜¾ç¤º

**é¢„è®¡å®Œæˆæ—¶é—´**: 3-4 å¤©

---

## âœ… ç”¨æˆ·å†³ç­–ç¡®è®¤

1. **ç®—æ³•æ–¹æ¡ˆ**ï¼ˆå·²ç¡®è®¤ï¼‰
   - âœ… **V1.0**: ä½¿ç”¨ Java ç®—æ³•ï¼ˆå¿«é€Ÿä¸Šçº¿ï¼‰
   - âœ… **V2.0**: è¿ç§»åˆ° Dart ç®—æ³•ï¼ˆå·²æ·»åŠ åˆ°é˜¶æ®µ 8ï¼‰

2. **åå°ä»»åŠ¡**ï¼ˆå·²ç¡®è®¤ï¼‰
   - âœ… **V1.0**: ä»…é€šçŸ¥åŠŸèƒ½ï¼ˆé˜¶æ®µ 5ï¼‰
   - âœ… **V2.0**: å®Œæ•´åå°ä»»åŠ¡ï¼ˆå·²æ·»åŠ åˆ°é˜¶æ®µ 9ï¼‰

3. **iOS æ”¯æŒ**ï¼ˆå·²ç¡®è®¤ï¼‰
   - âœ… **V1.0**: ä»… Android
   - âœ… **V2.0**: iOS æ”¯æŒï¼ˆå·²æ·»åŠ åˆ°é˜¶æ®µ 10ï¼Œå‰ææ˜¯ Dart ç®—æ³•å®Œæˆï¼‰

---

## ğŸ“ å¤‡æ³¨

- æœ¬è·¯çº¿å›¾åŸºäºå½“å‰å·²å®Œæˆçš„ UI æ¡†æ¶å’Œ Platform Channel åŸºç¡€
- æ—¶é—´ä¼°ç®—å‡è®¾æ¯å¤©æœ‰æ•ˆå·¥ä½œæ—¶é—´ 6-8 å°æ—¶
- å®é™…å¼€å‘ä¸­å¯èƒ½æ ¹æ®å…·ä½“æƒ…å†µè°ƒæ•´ä¼˜å…ˆçº§
- å…³é”®è·¯å¾„ï¼šé˜¶æ®µ 1 â†’ é˜¶æ®µ 3ï¼ˆç¦»çº¿å½•åˆ¶æ˜¯æ ¸å¿ƒåˆ›æ–°åŠŸèƒ½ï¼‰

---

**å‡†å¤‡å¥½å¼€å§‹é˜¶æ®µ 1 äº†å—ï¼Ÿè¯·å›å¤ "ok" ç¡®è®¤ï¼Œæˆ‘å°†ç«‹å³å¼€å§‹æ‰§è¡Œï¼** ğŸš€

