# 🔬 OpenRing 双版本策略

**当前定位**: 科研工具 (Research Edition)  
**未来规划**: 消费者应用 (Consumer Edition)

---

## 📊 版本定位对比

| 维度 | 科研版 (Research) | 消费者版 (Consumer) |
|------|------------------|-------------------|
| **目标用户** | 生理信号研究人员、算法开发者、医学研究者 | 普通健康监测用户 |
| **核心目标** | 数据采集、算法验证、实验记录 | 健康管理、日常监测 |
| **UI 风格** | 专业、信息密集、工具化 | 简洁、友好、趣味化 |
| **数据呈现** | 原始数据、多通道波形、详细指标 | 简化指标、趋势图表 |
| **功能深度** | 完整功能、高级设置、导出分析 | 核心功能、自动化 |
| **发布渠道** | 内部分发、GitHub Release | Google Play / App Store |

---

## 🔬 科研版 (当前阶段重点)

### 🎯 **核心价值**
> **为研究人员提供可靠的数据采集与分析工具**

### ✅ **功能优先级**

#### **P0 (必须有)**
1. **完整数据采集**
   - ✅ 12 通道实时波形（PPG×3, ACC×3, Gyro×3, Temp×3）
   - ✅ 可切换任意通道显示
   - ✅ 显示采样率、时间戳
   - ✅ 数据完整性校验

2. **离线录制管理**
   - ✅ 精确时长控制（可设置 1-3600 秒）
   - ✅ 分段录制配置
   - ✅ 录制状态详细监控
   - ✅ 自动/手动下载选项
   - ✅ 文件列表与管理

3. **数据导出**
   - ✅ CSV 导出（含时间戳、所有通道）
   - ✅ 原始文件导出（戒指格式）
   - ✅ 导出元数据（设备 MAC、录制时间、版本）
   - ✅ 批量导出历史记录

4. **算法验证工具**
   - ✅ 心率/呼吸率实时计算
   - ✅ 信号质量评估
   - ✅ 波形回放与标注
   - ✅ 算法参数可调节
   - ✅ 计算结果与原始数据对照

#### **P1 (应该有)**
5. **高级设置**
   - 采样率调整（如果硬件支持）
   - 传感器校准参数
   - 滤波器参数配置
   - 时间同步设置

6. **实验记录**
   - 受试者信息标注
   - 实验场景备注
   - 测量条件记录
   - 数据标签与分类

7. **数据分析辅助**
   - 波形缩放与平移
   - 峰值标记
   - 时间段选择导出
   - 频域分析（FFT）

---

### 🎨 **UI 设计原则（科研版）**

#### **专业性优先**
```
❌ 避免：过度美化、动画干扰、隐藏重要信息
✅ 强调：信息密度、数据可见性、精确控制
```

#### **布局调整建议**

**仪表盘页面**
```diff
- [渐变欢迎卡片] "早上好！开始今天的健康监测"
+ [设备状态卡片] 连接设备、电池电量、固件版本、MAC 地址

- [快速操作] 大图标按钮
+ [快速启动] 紧凑列表，含上次使用参数

+ [最近实验] 显示最近 5 次测量的时间、时长、文件大小
```

**测量页面**
```diff
保持：
✅ 数据源选择器（在线/离线/回放）
✅ 三通道波形图

增强：
+ [通道选择器] 可勾选显示/隐藏任意通道
+ [波形控制] 时间轴缩放、Y 轴缩放、暂停刷新
+ [实时统计] 当前采样数量、缓冲区状态、丢包率
+ [标注工具] 点击波形添加时间标记、事件标注

调整：
- 移除心跳动画（科研场景不需要）
+ 改为静态数值 + 置信度指示器
```

**历史页面**
```diff
增强：
+ [详细信息] 每条记录显示：
  - 采样点数
  - 文件大小
  - 平均信号质量
  - 计算出的 HR/RR 范围
+ [批量操作] 多选、批量导出、批量删除
+ [筛选排序] 按日期、时长、质量排序
```

**设置页面**
```diff
新增科研专用设置：
+ [数据采集设置]
  - 采样率（25Hz 默认）
  - 数据缓冲区大小
  - 自动保存间隔
  
+ [算法参数]
  - HR 计算窗口 (8s)
  - RR 计算窗口 (30s)
  - 滤波器截止频率
  - 峰值检测阈值

+ [导出设置]
  - CSV 格式选项（逗号/制表符）
  - 时间戳格式（Unix/ISO8601）
  - 数值精度（保留小数位）

+ [实验管理]
  - 受试者信息模板
  - 实验场景预设
```

---

### 📋 **科研版独有功能清单**

#### **1. 波形标注工具**
```dart
// 功能描述
- 点击波形添加时间戳标记
- 标记类型：事件开始/事件结束/异常点/手动标记
- 标注导出到 CSV（单独列）
- 回放时显示标注点
```

#### **2. 批量实验管理**
```dart
// 功能描述
- 创建实验项目（如 "睡眠研究 2025-01"）
- 添加多个受试者
- 每次测量关联到受试者
- 批量导出整个实验的数据
```

#### **3. 数据质量报告**
```dart
// 功能描述
- 测量完成后生成质量报告
- 包含：信号质量统计、异常时间段、建议重测
- 导出为 PDF（含波形截图）
```

#### **4. 实时协议模式**
```dart
// 功能描述
- 按预设协议自动控制测量流程
- 例如："静息 5min → 深呼吸 2min → 静息 3min"
- 自动标记各阶段
- 避免手动操作误差
```

#### **5. 多设备同步**
```dart
// 功能描述
- 同时连接多个戒指（如果硬件支持）
- 时间戳对齐
- 多受试者并行采集
```

---

### 🎨 **科研版 UI Mock (简化示意)**

**测量页面**
```
┌─────────────────────────────────────────────┐
│ ← 实时测量         [📡在线] ▼      ⚙️ 设置   │
├─────────────────────────────────────────────┤
│ 设备: Ring-A1B2  电量:78%  质量:优秀 ▓▓▓▓▓│
│ 采样率:25Hz  已采:2048样本  时长:01:22     │
├─────────────────────────────────────────────┤
│ 通道选择: [✓PPG-G][✓PPG-R][✓PPG-IR]        │
│          [ ACC-X][ ACC-Y][ ACC-Z]          │
│          [ Gyro][ Temp]                    │
├─────────────────────────────────────────────┤
│ HR: 72 BPM (±3)  RR: 16 RPM (±1)          │
├─────────────────────────────────────────────┤
│ ╱╲╱╲╱╲ PPG Green  [缩放±] [标注📍]        │
│ ╱╲╱╲╱╲ PPG Red                            │
│ ╱╲╱╲╱╲ PPG IR                             │
│                                             │
│ 时间轴: [-----|-----*-----|-----] 暂停⏸   │
│          0s    41s  82s   123s              │
├─────────────────────────────────────────────┤
│ 标注: • 41s 深呼吸开始 [✏️编辑]            │
├─────────────────────────────────────────────┤
│ [⏹ 停止并保存] [📤 导出当前段] [🗑️ 丢弃] │
└─────────────────────────────────────────────┘
```

---

## 👥 消费者版 (未来规划)

### 🎯 **核心价值**
> **让普通用户轻松了解自己的健康状态**

### ✅ **功能简化**

#### **保留功能（简化呈现）**
1. **快速测量**
   - 一键开始，自动停止
   - 仅显示心率、呼吸率
   - 简化波形（单通道，美化图表）

2. **历史趋势**
   - 折线图显示心率变化
   - 每日/每周/每月汇总
   - 健康评分

3. **智能提醒**
   - 异常心率提醒
   - 每日测量提醒

#### **移除功能**
- ❌ 12 通道波形（仅保留 PPG Green）
- ❌ 离线录制（改为后台自动）
- ❌ 原始数据导出（仅导出摘要）
- ❌ 算法参数调节
- ❌ 标注工具

---

### 🎨 **UI 设计原则（消费者版）**

#### **简洁友好**
```
✅ 强调：大图标、动画引导、渐进式展示
✅ 使用：健康评分、颜色编码（绿/黄/红）
✅ 隐藏：技术细节、复杂参数
```

#### **消费者版 UI Mock**

**主页**
```
┌─────────────────────────┐
│   💍 OpenRing           │
├─────────────────────────┤
│ [渐变卡片]              │
│  今日健康评分: 85/100   │
│  😊 一切正常            │
│  ❤️ 平均心率: 72 BPM   │
│  🫁 呼吸平稳            │
│  [开始测量]             │
├─────────────────────────┤
│ 本周趋势                │
│  ╱╲╱ 心率趋势图        │
│  📊 数据详情 →         │
├─────────────────────────┤
│ 💡 健康小贴士           │
│  "保持规律的作息..."    │
└─────────────────────────┘
```

---

## 🚀 实施计划

### **阶段 1: 科研版完善 (当前，4-6 周)**

#### **Week 1-2: 数据采集增强**
- [ ] 实现 12 通道完整显示
- [ ] 添加通道选择器
- [ ] 实现波形缩放/平移
- [ ] 添加采样统计信息

#### **Week 3: 离线录制优化**
- [ ] 精确时长控制 UI
- [ ] 录制状态详细显示
- [ ] 文件管理增强

#### **Week 4: 数据导出**
- [ ] CSV 导出（完整格式）
- [ ] 批量导出
- [ ] 导出设置页面

#### **Week 5: 高级功能**
- [ ] 波形标注工具
- [ ] 实验管理
- [ ] 算法参数调节

#### **Week 6: 测试优化**
- [ ] 真实科研场景测试
- [ ] 数据准确性验证
- [ ] 性能优化

**验收标准**:
- ✅ 可导出完整 12 通道数据
- ✅ 离线录制成功率 > 95%
- ✅ 算法与原生 Java 版误差 < 3%
- ✅ 支持 ≥ 3 小时连续录制

---

### **阶段 2: 消费者版原型 (6-8 周后)**

#### **策略: 双版本共存**

**方案 A: Build Flavor (推荐)**
```gradle
// android/app/build.gradle
android {
    flavorDimensions "version"
    productFlavors {
        research {
            dimension "version"
            applicationIdSuffix ".research"
            versionNameSuffix "-research"
        }
        consumer {
            dimension "version"
            applicationIdSuffix ".consumer"
        }
    }
}
```

**方案 B: 功能开关**
```dart
// lib/config/app_config.dart
enum AppEdition { research, consumer }

class AppConfig {
  static const edition = AppEdition.research; // 编译时切换
  
  static bool get isResearchEdition => edition == AppEdition.research;
  static bool get showAllChannels => isResearchEdition;
  static bool get enableAnnotation => isResearchEdition;
  static bool get showRawData => isResearchEdition;
}
```

#### **Week 7-8: UI 简化**
- [ ] 创建消费者版主题
- [ ] 简化测量页面（单通道）
- [ ] 实现健康评分算法

#### **Week 9-10: 功能适配**
- [ ] 自动测量流程
- [ ] 趋势图表
- [ ] 智能提醒

#### **Week 11-12: 发布准备**
- [ ] Google Play 素材
- [ ] 用户引导流程
- [ ] 隐私政策

---

## 📊 双版本功能对照表

| 功能模块 | 科研版 | 消费者版 |
|---------|-------|---------|
| **BLE 连接** | ✅ 手动扫描连接 | ✅ 自动连接 |
| **实时测量** | ✅ 手动控制时长 | ✅ 自动 60 秒 |
| **波形显示** | ✅ 12 通道可选 | ✅ 仅 PPG Green (美化) |
| **波形控制** | ✅ 缩放/标注/导出 | ❌ |
| **心率呼吸率** | ✅ 含置信度 | ✅ 仅数值 |
| **离线录制** | ✅ 完整控制 | ❌ (改为后台自动) |
| **文件管理** | ✅ 完整管理 | ❌ |
| **数据导出** | ✅ CSV/原始文件 | ✅ 仅摘要 PDF |
| **历史记录** | ✅ 详细列表 | ✅ 趋势图表 |
| **实验管理** | ✅ | ❌ |
| **算法参数** | ✅ 可调节 | ❌ |
| **健康评分** | ❌ | ✅ |
| **智能提醒** | ❌ | ✅ |
| **深色模式** | ✅ | ✅ |

---

## 🎯 当前行动项（科研版优先）

### **立即调整（本周）**

1. **移除过度装饰**
   ```dart
   // home_page.dart
   - 移除 "早上好" 问候语卡片
   + 改为设备状态信息卡片（MAC、电量、版本）
   
   // measurement_page.dart
   - 移除心跳动画
   + 改为静态数值 + 数据质量指示器
   ```

2. **增加信息密度**
   ```dart
   // 所有页面
   - 减小 padding（24px → 12px）
   - 增加文字信息（采样率、时间戳等）
   - 显示技术参数
   ```

3. **添加科研工具**
   ```dart
   // measurement_page.dart
   + 添加通道选择器
   + 添加波形控制工具栏
   + 添加实时统计面板
   ```

### **下周开发**

4. **实现完整数据导出**
   - CSV 格式（含所有通道）
   - 元数据头部
   - 批量导出

5. **离线录制详细控制**
   - 精确时长输入
   - 分段设置
   - 下载进度详情

---

## 📝 文档更新

### **更新现有文档**

**README.md**
```diff
- 精致的智能戒指健康监测应用
+ OpenRing 科研版 - 生理信号采集与分析工具

- Material Design 3 风格
+ 专业数据采集界面

目标用户：
+ - 生理信号研究人员
+ - 算法开发者
+ - 医学实验研究者
```

**FEATURES.md**
```diff
+ ## 科研版特性
+ 
+ ### 完整数据采集
+ - 12 通道实时波形
+ - 可配置采样率
+ - 数据完整性校验
+ 
+ ### 专业分析工具
+ - 波形标注
+ - 算法参数调节
+ - 批量实验管理
```

---

## 🎊 总结

### **当前阶段（科研版）**
> **优先数据准确性、功能完整性、专业工具性**
- 保留精致 UI 的基础上，增加信息密度
- 添加科研专用功能（标注、导出、参数调节）
- 优化数据采集稳定性

### **未来阶段（消费者版）**
> **简化功能、美化体验、智能引导**
- 基于科研版稳定的数据采集能力
- 简化 UI，隐藏技术细节
- 添加健康评分、趋势分析

### **技术策略**
- 使用 Build Flavor 或功能开关区分版本
- 共享核心数据采集代码
- UI 层完全独立

---

**科研版先行，消费者版跟进，双版本协同发展！** 🚀





